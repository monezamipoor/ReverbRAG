seed: 42

run:
  model: avnerf                # {neraf | avnerf}
  database: raf               # {raf | soundspaces}
  scene: FurnishedRoom        # e.g., EmptyRoom, FurnishedRoom
  sample_rate: 48000
  epochs: 100
  save_root: ./checkpoints          # root for run folders
  save_every: 10              # save every N epochs
  resume:
    checkpoint: null        # e.g., ./runs/raf/FurnishedRoom/20251106-2130_base/epoch_50.pt
    load_optimizer: false     # if true, restore optimizer state (and LR scheduler progress)
    lr_override: null         # e.g., 1e-4; if set, forces this LR after resume

  losses:
    sc: 0.0              # weight for spectral convergence loss
    mag: 0.0             # weight for log-magnitude loss
    mag_loss_type: mse   # {l1 | mse} for the log-mag term
    mse: 1.0             # set >0 to add F.mse_loss(log_pred, log_gt)
    # EDC loss (forces full-STFT sampler when > 0)
    edc: 0.2             # 0.0 disables EDC
    # Envelope / residual regularization
    env_rms: 0.1         # weight for global RMS envelope loss (log-domain, uses full STFT)
    res_l2: 0.0          # L2 regularization on residual log-STFT
    # Global scale for the total loss (applied at the end)
    global_scale: 1.0e-3
    optimizer: avnerf    # {neraf | avnerf} selects which pred to use for loss

renders:
  save_renders: ./renders   # set to null to disable
  model: ./checkpoints/20251110-2341_base/epoch_60.pt  # path to trained model; set to null to use latest checkpoint from run

  # logging
  log_every: 50               # iterations

sampler:
  batch_size: 2048         # Normal batch size (Not EDC mode)
  rirs_per_batch: 40       # only for EDC mode
  shuffle: true
  num_workers: 8

wandb:
  project: ReverbRAG
  api_key: null    # optional; leave null if you've already `wandb login`

databases:
  raf:
    root: ../NeRAF/data/RAF
  soundspaces:
    root: /data/SoundSpaces

model:

  envelope:
    enabled: true                # flip this off for ablations
    hidden: [2048, 1024, 1024, 512]  # 4-layer MLP  1024,512,256,256    2048, 1024, 1024, 512
    act: lrelu                    # {relu | lrelu | gelu | silu}
    tanh_scale: 0.0               # scale for tanh-bounded log envelope
    n_frames: 60                  # expected T; matches EDC bins
    normalize: true               # normalize residual STFT mags
    combine_mode: "log"           # or "log" how to combine envelope + detail

  reverbrag:
    enabled: false
    fusion: film         # {film | concat | input}
    k: 1                      # we only use top-1 here
    num_bands: 32             # features are [32 x 4]
    gating: true              # enable scalar gate

    # reference MLP over 32x4 features
    mlp_hidden: [128, 256, 256]
    mlp_act: lrelu             # {gelu | relu | lrelu | silu}
    feature_norm: "layernorm"

    # FiLM parameters
    film_strength: 0.15        # near-identity at init
    learnable_film: true      # make scales learnable (recommended)

  neraf_encoder:
    hidden: [5096, 2048, 1024, 1024]
  avnerf_encoder:
    hidden: [5096, 2048, 1024, 1024]
  decoder:
    # empty list = single Linear(W, N_freq) per channel (old behaviour)
    # e.g. [2048, 1024] would give W -> 2048 -> 1024 -> N_freq
    hidden: []